import{a as t}from"./vendor.daadd3da.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(i){const s=new URL(t,location),a=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((i,h)=>{const r=new URL(t,s);if(self[e].moduleMap[r])return i(self[e].moduleMap[r]);const d=new Blob([`import * as m from '${r}';`,`${e}.moduleMap['${r}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){h(new Error(`Failed to import: ${t}`)),a(o)},onload(){i(self[e].moduleMap[r]),a(o)}});document.head.appendChild(o)})),self[e].moduleMap={}}}("/assets/");class e extends Phaser.Scene{constructor(){super({key:"BootScene"}),this.timeCardIsVisible=800,this.imagesArr=[]}init(){const t=window.location.search,e=new URLSearchParams(t);this.gameId=e.get("id")}async preload(){this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js");const e="http://localhost",i=e+"/api/games/game/"+this.gameId;await t.get(i).then((t=>{console.log(t.data);const i=t.data.config;this.timeToComplete=i.time_to_complete,this.maxAttempts=i.max_attempts,this.destroyCard=i.destroyCard,this.totalCards=i.total_images;const s=t.data.assets,a=s.images.back_card;this.load.on("complete",(()=>this.createCustom())),this.load.image(a.id,e+a.path+a.server_path),this.backCardId=a.id;for(let h=0;h<this.totalCards;h++){let t=s.images.front_cards[h];this.load.image(t.id,e+t.path+t.server_path),this.imagesArr.push(t.id)}this.load.image("star","assets/images/star.png"),this.load.start()})).catch((function(t){console.log(t)}))}createCustom(){this.scene.start("GameScene",{destroyCard:this.destroyCard,timeCardIsVisible:this.timeCardIsVisible,timeToComplete:this.timeToComplete,maxAttempts:this.maxAttempts,imagesArr:this.imagesArr,backCardId:this.backCardId})}}let i={TOTAL:0,CURRENT:0,ATTEMPTS:0,MAX_ATTEMPTS:0,TIME:0,GAME_OVER:!1};class s{constructor(t,e,i,s,a,h){this.flipSpeed=200,this.flipZoom=1.1,this.cardIsBack=!0,this.scene=t,this.cardW=e,this.cardH=i,this.cardImgRef=s,this.cardFrontTexture=a,this.cardBackTexture=h,this.buildCard()}buildCard(){this.cardBack=this.scene.add.image(0,0,this.cardBackTexture).setOrigin(0).setVisible(!1);let t=this.scene.add.image(0,0,this.cardFrontTexture).setOrigin(0).setVisible(!1);this.scaleX_Back=this.cardW/this.cardBack.width,this.scaleY_Back=this.cardH/this.cardBack.height;let e=this.cardW/t.width,i=this.cardH/t.height;this.cardBack.setScale(this.scaleX_Back,this.scaleY_Back),t.setScale(e,i);let s=this.scene.make.renderTexture({width:this.cardW,height:this.cardH},!1);s.draw(this.cardBack,0,0).saveTexture("card_back"),s=this.scene.make.renderTexture({width:this.cardW,height:this.cardH},!1),s.draw(t,0,0).saveTexture("card_front_"+this.cardFrontTexture)}placeCard(t,e){let i=this.scaleX_Back*this.cardBack.width/2,s=this.scaleX_Back*this.cardBack.height/2;this.cardBack=this.scene.add.image(t+i,e+s,"card_back").setInteractive()}flipCard(){this.cardBack.disableInteractive(),this.cardIsBack=!this.cardIsBack,this.flipTween=this.scene.tweens.add({targets:this.cardBack,scaleY:this.flipZoom,scaleX:.1,duration:this.flipSpeed,ease:"Power1",yoyo:!0,onComplete:()=>this.onCompleteHandler(this.cardBack),onYoyo:()=>this.onCardComeBack(this.cardBack)})}onCardComeBack(t){this.cardIsBack?t.setTexture("card_back"):t.setTexture("card_front_"+this.cardFrontTexture)}onCompleteHandler(t){this.cardBack.setInteractive()}newCardPosition(t,e){this.cardX=t,this.cardY=e}getCard(){return this.cardBack}getCardImgRef(){return this.cardImgRef}getCardIsBack(){return this.cardIsBack}}class a{constructor(t,e,i){this.scene=t,this.gameWidth=e,this.gameHeight=i,this.barBody=new Phaser.GameObjects.Graphics(this.scene),this.barHeightScale=8,this.barColor=170,this.barStrokeColor=16763904,this.buildBar()}buildBar(){this.barBody=this.scene.add.graphics(),this.barBody.beginPath(),this.barBody.fillStyle(this.barStrokeColor,1),this.barBody.fillRoundedRect(0,0,this.gameWidth,this.gameHeight/(this.barHeightScale-.3),{tl:0,tr:0,bl:20,br:20}),this.barBody.strokePath(),this.barBody.closePath(),this.barBody.beginPath(),this.barBody.fillStyle(this.barColor,1),this.barBody.fillRoundedRect(0,0,this.gameWidth,this.gameHeight/this.barHeightScale,{tl:0,tr:0,bl:24,br:24}),this.barBody.strokePath(),this.barBody.closePath()}getHeight(){return this.gameHeight/this.barHeightScale}}class h{constructor(t,e,i,s){this.gapInBetween=50,this.gapSide=100,this.scene=t,this.boardW=e-2*this.gapSide,this.centerGridOffsetY=s,this.boardH=i-this.centerGridOffsetY-2*this.gapSide}doGridCalculations(t,e){this.numCardsW=t,this.numCardsH=e;return{width:this.boardW/t-this.gapInBetween,height:this.boardH/e-this.gapInBetween}}createGrid(t,e,i){let s=0;for(let a=0;a<this.numCardsH;a++)for(let h=0;h<this.numCardsW;h++)t[s].placeCard(h*(e+this.gapInBetween)+this.gapSide+this.gapInBetween/2,a*(i+this.gapInBetween)+this.centerGridOffsetY+this.gapSide),s++;console.log(i/2),console.log(t)}}class r extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.cards=[],this.matches=0,this.flippedCardsIndex=[]}init(t){switch(this.gameHeight=this.sys.canvas.height,this.gameWidth=this.sys.canvas.width,this.destroyCard=t.destroyCard,this.timeCardIsVisible=t.timeCardIsVisible,this.imagesArr=t.imagesArr,this.timeToComplete=t.timeToComplete,this.maxAttempts=t.maxAttempts,this.backCardId=t.backCardId,this.imagesArr.length){case 3:this.numCardsHorizontal=3,this.numCardsVertical=2;break;case 6:this.numCardsHorizontal=4,this.numCardsVertical=3;break;case 8:this.numCardsHorizontal=4,this.numCardsVertical=4;break;case 10:this.numCardsHorizontal=5,this.numCardsVertical=4}}create(){this.topBar=new a(this,this.gameWidth,this.gameHeight),this.grid=new h(this,this.gameWidth,this.gameHeight,this.topBar.getHeight());const{width:t,height:e}=this.grid.doGridCalculations(this.numCardsHorizontal,this.numCardsVertical),r=[];this.imagesArr.forEach(((t,e)=>{r.push(e),r.push(e)})),(t=>{for(var e,i,s=t.length;0!==s;)i=Math.floor(Math.random()*s),e=t[s-=1],t[s]=t[i],t[i]=e;return t})(r).forEach(((i,a)=>this.cards.push(new s(this,t,e,i,this.imagesArr[i],this.backCardId)))),this.grid.createGrid(this.cards,t,e),this.input.on("gameobjectdown",this.cardDown,this),i.TOTAL=this.imagesArr.length;let d="";this.timeToComplete?(this.displayText="Tempo para acabar o jogo\n",i.TIME=this.timeToComplete,d=`${this.displayText}${i.TIME}`,this.timedEvent=this.time.delayedCall(1e3*this.timeToComplete,this.onEventTimeOver,[],this)):this.maxAttempts?(this.displayText="Tentativas restantes para acabar o jogo\n",i.MAX_ATTEMPTS=this.maxAttempts,d=`${this.displayText}${i.MAX_ATTEMPTS}`):(this.displayText="Tentativas\n",d=`${this.displayText}${i.ATTEMPTS}`),this.text=this.add.text(0,16,d,{fontFamily:"Arial",fontSize:32,color:"#ffffff",align:"center"}),this.text.setPosition(this.gameWidth/2-this.text.width/2,this.topBar.getHeight()/2-this.text.height/2)}cardDown(t,e,s){const a=this.cards.find((t=>t.getCard()===e));if(a&&this.flippedCardsIndex.length<2&&a.getCardIsBack()&&!i.GAME_OVER){a.flipCard();const t=this.cards.findIndex((t=>t.getCard()===e)),i=a.getCardImgRef();this.flippedCardsIndex.push({index:t,imageRef:i}),2===this.flippedCardsIndex.length&&this.time.delayedCall(this.timeCardIsVisible,this.checkPairMatch,[],this)}}checkPairMatch(){const t=this.flippedCardsIndex[0],e=this.flippedCardsIndex[1];(null==t?void 0:t.imageRef)===(null==e?void 0:e.imageRef)?(console.log("match!!"),this.flippedCardsIndex.forEach((t=>{this.destroyCard?this.cards[t.index].getCard().setVisible(!1):this.cards[t.index].getCard().disableInteractive()})),this.matches++,this.matches===this.imagesArr.length&&(i.GAME_OVER=!0,this.scene.launch("GameWinScene",{width:this.gameWidth,height:this.gameHeight,win:!0}))):(console.log("try again"),this.flippedCardsIndex.forEach((t=>{this.cards[t.index].flipCard()}))),this.maxAttempts?(i.MAX_ATTEMPTS--,this.text.setText(`${this.displayText}${i.MAX_ATTEMPTS}`),0===i.MAX_ATTEMPTS&&(i.GAME_OVER=!0)):(i.ATTEMPTS++,this.text.setText(`${this.displayText}${i.ATTEMPTS}`)),this.flippedCardsIndex=[]}onEventTimeOver(){console.log("time over"),i.GAME_OVER=!0,this.scene.launch("GameWinScene",{width:this.gameWidth,height:this.gameHeight,win:!1})}update(){this.timeToComplete&&!i.GAME_OVER&&this.text.setText(`${this.displayText}${(this.timeToComplete-this.timedEvent.elapsed/1e3).toFixed(0)}`)}}class d{constructor(t,e,i,s,a,h){this.scene=t,this.barColor=170,this.barStrokeColor=16763904,this.buildMenu(e,i,s,a,h)}buildMenu(t,e,i,s,a){this.menuRect=this.scene.add.graphics(),this.menuRect.beginPath(),this.menuRect.fillStyle(this.barStrokeColor,1),this.menuRect.fillRoundedRect(t-a/2,e-a/2,i+a,s+a,{tl:20,tr:20,bl:20,br:20}),this.menuRect.strokePath(),this.menuRect.closePath(),this.menuRect.beginPath(),this.menuRect.fillStyle(this.barColor,1),this.menuRect.fillRoundedRect(t,e,i,s,{tl:20,tr:20,bl:20,br:20}),this.menuRect.strokePath(),this.menuRect.closePath()}getMenuRect(){return this.menuRect}}class o extends Phaser.Scene{constructor(){super({key:"GameWinScene"})}init(t){this.gameWidth=t.width,this.gameHeight=t.height,this.win=t.win}create(){this.modal=this.add.rectangle(0,0,this.gameWidth,this.gameHeight,0,.6).setOrigin(0);const t=.5*this.gameWidth,e=.5*this.gameHeight,i=this.gameWidth/2-t/2,s=this.gameHeight/2-e/2,a=.015*t;this.menu=new d(this,i,s,t,e,a);let h="";h=this.win?"Parabéns, ganhaste!":"Não conseguiste, tenta outra vez!";let r=this.add.text(0,0,h,{fontFamily:"Arial",fontSize:32,color:"#ffffff",align:"center"});r.setPosition(this.gameWidth/2,s+2*r.height).setOrigin(.5);var o=new Phaser.Geom.Circle(this.gameWidth/2,s+e/2.2,(e-s)/2.1).getPoints(12);let n=0;for(var c=0;c<o.length;c++){var l=o[c];n>o.length-2?n=0:n++;let t=this.add.image(l.x,l.y,"star").setScale(.1).setTint(16763904);this.tweens.add({targets:t,scaleX:.15625,scaleY:.15625,ease:"Sine.easeInOut",duration:1e3,repeat:-1,yoyo:!0})}this.btn=this.add.graphics(),this.btn.fillStyle(16776960,1);const m=t/2,g=e/8,p=this.gameWidth/2-t/4,u=s+.8*e;this.btn.fillRoundedRect(p,u,m,g,24),this.add.text(0,0,"Jogar novamente",{fontFamily:"Arial",fontSize:32,color:"#0000aa",align:"center"}).setPosition(this.gameWidth/2,u+r.height).setOrigin(.5);var C=new Phaser.Geom.Rectangle(p,u,m,g);this.btn.setInteractive(C,Phaser.Geom.Rectangle.Contains),this.btn.on("pointerdown",(()=>{window.location.reload()}))}}const n={type:Phaser.AUTO,parent:"game",backgroundColor:2772329,scale:{width:1600,height:1200,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},fps:{target:30,forceSetTimeOut:!0},scene:[e,r,o]};class c extends Phaser.Game{constructor(t){super(t)}}window.addEventListener("load",(()=>{new c(n)}));
