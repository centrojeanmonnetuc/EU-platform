import{a as t}from"./vendor.daadd3da.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const i=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,o)=>{const n=new URL(t,i);if(self[e].moduleMap[n])return s(self[e].moduleMap[n]);const h=new Blob([`import * as m from '${n}';`,`${e}.moduleMap['${n}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(h),onerror(){o(new Error(`Failed to import: ${t}`)),r(a)},onload(){s(self[e].moduleMap[n]),r(a)}});document.head.appendChild(a)})),self[e].moduleMap={}}}("/assets/");class e extends Phaser.Scene{constructor(){super({key:"BootScene"}),this.prefix=""}init(){const t=window.location.search,e=new URLSearchParams(t);this.gameId=e.get("id")}async preload(){t({method:"post",url:this.prefix+"/api/games/statistics-game-opened",data:{gameId:this.gameId}}),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js");const e=this.prefix+"/api/games/game/"+this.gameId;await t.get(e).then((t=>{console.log(t.data);const e=t.data.config;this.num_horizontal_cells=e.num_horizontal_cells,this.num_vertical_cells=e.num_vertical_cells,this.words=e.words,this.directions=e.directions,this.timer=e.timer,this.time_to_complete=e.time_to_complete,this.load.on("complete",(()=>this.createCustom())),this.load.image("bg","./assets/images/bg.jpg"),this.load.image("hourglass","assets/images/hourglass.png"),this.load.image("star","assets/images/star.png"),this.load.audio("right_guess","./assets/sounds/right_guess.mp3"),this.load.audio("finish_game","./assets/sounds/finish_game.mp3"),this.load.audio("game_over","./assets/sounds/game_over.mp3"),this.load.start()})).catch((function(t){console.log(t)}))}createCustom(){this.scene.start("GameScene",{num_horizontal_cells:this.num_horizontal_cells,num_vertical_cells:this.num_vertical_cells,words:this.words,directions:this.directions,timer:this.timer,time_to_complete:this.time_to_complete,prefix:this.prefix,gameId:this.gameId})}}let s={CURRENT_WORDS_D:0,TOTAL_WORDS:0,TIME:0,GAME_OVER:!1,WIN:!1};const i=(t,e,s)=>{let i=1,r=1;i=t/s.width,r=e/s.height;let o=Math.min(Number(i.toFixed(3)),Number(r.toFixed(3)));return s.setScale(o),s.setData("scaled_value",o),s.setData("scaled_w",Math.floor(s.width*o)),s.setData("scaled_h",Math.floor(s.height*o)),s};class r{constructor(t,e,s,i){this.scene=t,this.backgroundImage=this.scene.add.image(0,0,e),this.backgroundImage=this.fitImage(this.backgroundImage,s,i)}fitImage(t,e,s){return(t=i(1.3*e,s,t)).setOrigin(0),t}setAlpha(t){this.backgroundImage.setAlpha(t)}}class o{constructor(t,e,s){this.endingColor=16711680,this.scene=t,this.clockImage=this.scene.add.image(0,0,"hourglass"),this.clockImage=i(e,s,this.clockImage),this.timeContainer=this.scene.add.container(),this.text=this.scene.add.text(0,16,"100",{fontFamily:"Arial",fontSize:64,color:"#ffffff",align:"center"}),this.text.setPosition(this.clockImage.getBounds().right+20,this.clockImage.y),this.text.setOrigin(0,.5),this.timeContainer.add(this.clockImage),this.timeContainer.add(this.text);const r=this.clockImage.getBounds().left+this.text.getBounds().right;this.timeContainer.setPosition(e/2-r/2,s)}updateTime(t){12===parseInt(t)&&this.shakeImage(),parseInt(t)<=10&&this.text.setTint(this.endingColor),this.text.setText(t)}shakeImage(){this.scene.tweens.add({targets:this.clockImage,duration:500,ease:"Sine.easeInOut",yoyo:!0,repeat:-1,scale:this.clockImage.getData("scaled_value")+.2*this.clockImage.getData("scaled_value")})}cancelAnims(){this.scene.tweens.destroy()}}class n{constructor(t,e,s,i,r,o){this.wordsInfo={input:[],placed:[],not_placed:[]},this.scene=t,this.empty_char=o,this.wordSearch(i,e,s,r)}getGrid(){return this.grid}wordSearch(t,e,s,i){var r,o,n;t.sort((function(t,e){return t.word.length<e.word.length?1:-1})),this.grid=this.createGrid(e,s),this.grid=this.initGrid(this.grid,e,s,this.empty_char),this.printGrid(this.grid,e,s);for(let d=0;d<t.length;d++){const c=t[d];console.log("start putting the word: "+c.word);var h=!1;const g=this.getGridFreePositions(this.grid,e,s);var a=[...i];for(console.log(a);a.length>0&&!h;){r=a[this.getRandomProb(a.length)],o=this.wordDirection(r),a=this.removeItemOnce(a,r);for(var l=[...g];l.length>0&&!h;){const t={wordObj:c,start_x:(n=l[this.getRandomNum(0,l.length-1)]).x,start_y:n.y,end_x:n.x+o.right*(c.word.length-1),end_y:n.y+o.down*(c.word.length-1),direction:o};this.wordInsideGrid(t,e,s)&&(this.wordColision(this.grid,t)||(this.grid=this.placeWord(this.grid,t),h=!0,this.wordsInfo.placed.push(t))),l=this.removeItemOnce(l,n)}}h||this.wordsInfo.not_placed.push(c)}this.printGrid(this.grid,e,s)}wordColision(t,e){let s,i=!1,r=e.start_x,o=e.start_y,n=e.direction.type;for(let h=0;h<e.wordObj.word.length;h++)"right"==n?s=t[o][r+h]:"down"==n?s=t[o+h][r]:"right_down"==n?s=t[o+h][r+h]:"left_down"==n&&(s=t[o+h][r-h]),s!=this.empty_char&&s!=e.wordObj.word[h]&&(i=!0);return i}placeWord(t,e){let s=e.direction.type,i=e.start_x,r=e.start_y;for(let o=0;o<e.wordObj.word.length;o++)"down"==s?t[r+o][i]=e.wordObj.word[o]:"right"==s?t[r][i+o]=e.wordObj.word[o]:"right_down"==s?t[r+o][i+o]=e.wordObj.word[o]:"left_down"==s&&(t[r+o][i-o]=e.wordObj.word[o]);return t}wordInsideGrid(t,e,s){return!(t.end_x>=e)&&(!(t.end_y>=s)&&!(t.end_x<0))}wordDirection(t){let e=0,s=0;return"down"==t?e=1:"right"==t?s=1:"right_down"==t?(s=1,e=1):"left_down"==t&&(s=-1,e=1),{right:s,down:e,type:t}}getRandomProb(t){var e=Math.random();return 4==t?e<.4?0:e<.8?1:e<.9?2:3:3==t?e<.45?0:e<.9?1:2:2==t?e<.5?0:1:0}removeItemOnce(t,e){var s=t.indexOf(e);return s>-1&&t.splice(s,1),t}getRandomNum(t,e){return Math.floor(Math.random()*(e+1))+t}createGrid(t,e){var s=new Array(e);for(let i=0;i<e;++i)s[i]=new Array(t);return s}initGrid(t,e,s,i){for(let r=0;r<s;r++)for(let s=0;s<e;s++)t[r][s]=i;return t}printGrid(t,e,s){let i="";for(let r=0;r<s;r++){for(let s=0;s<e;s++)i+=t[r][s]+" ";i+="\n"}console.log("printing word puzzle grid\n\n"+i)}getGridFreePositions(t,e,s){let i=[];for(let r=0;r<s;r++)for(let s=0;s<e;s++)t[r][s]==this.empty_char&&i.push({x:s,y:r});return i}}class h{constructor(t,e,s,i,r,o){this.scene=t,this.populatedGrid=this.populateGridRndChars(e,s,i,r,o)}getPopulatedGrid(){return this.populatedGrid}populateGridRndChars(t,e,s,i,r){for(let o=0;o<s;o++)for(let s=0;s<e;s++)t[o][s]==i&&(t[o][s]=this.randomCharFromStr(r));return t}randomCharFromStr(t){return t[this.getRandomNum(0,t.length-1)]}getRandomNum(t,e){return Math.floor(Math.random()*(e+1))+t}}class a{constructor(t,e,s,i,r,o){this.scene=t,this.lineColor=i,this.num_hor_cells=r,this.emitter=o,this.selection=this.scene.add.graphics(),this.selection.setDepth(2),this.line=new Phaser.Geom.Line,this.scene.add.graphics({lineStyle:{width:3,color:this.lineColor,alpha:.6}}),this.drawLine(this.selection,this.line,this.lineColor,s,e)}drawLine(t,e,s,i,r){this.scene.input.on("pointerdown",((r,o)=>{if(!o[0])return;const n=o[0].getBounds();e.setTo(n.centerX,n.centerY,r.x,r.y),t.clear(),t.lineStyle(2,s),t.strokeLineShape(e),this.firstObj=this.findClickedChar(i,o[0])})),this.scene.input.on("pointermove",((i,r)=>{r[0]?i.isDown&&(e.x2=i.x,e.y2=i.y,t.clear(),t.lineStyle(20,s),t.setAlpha(.5),t.strokeLineShape(e)):t.clear()})),this.scene.input.on("pointerup",((e,s)=>{if(!s[0])return void t.clear();this.lastObj=this.findClickedChar(i,s[0]),t.clear();const o=this.discoverUserInput(this.firstObj,this.lastObj);if(o.length>0){const t=this.getWord(o,r);console.log(t),this.emitter.emit("guessedWord",{gridInfo:o,word:t})}}))}findClickedChar(t,e){for(const s of t)if(s.getCellImg()===e)return s;return null}getWord(t,e){let s="";for(const i of t)s+=e[i.y][i.x];return s}discoverUserInput(t,e){const s={start_x:t.getGridPos().x,start_y:t.getGridPos().y,end_x:e.getGridPos().x,end_y:e.getGridPos().y,selected_coors:[]};if(s.start_x+s.start_y>s.end_x+s.end_y&&(console.log("troca"),s.start_x=e.getGridPos().x,s.start_y=e.getGridPos().y,s.end_x=t.getGridPos().x,s.end_y=t.getGridPos().y),s.start_x==s.end_x)for(let i=s.start_y;i<=s.end_y;i++)s.selected_coors.push({x:s.start_x,y:i});else if(s.start_y==s.end_y)for(let i=s.start_x;i<=s.end_x;i++)s.selected_coors.push({x:i,y:s.start_y});else if(s.start_x-s.start_y==s.end_x-s.end_y){let t=s.start_x;for(let e=s.start_y;e<=s.end_y;e++)s.selected_coors.push({x:t++,y:e})}else if(s.start_x+s.start_y==s.end_x+s.end_y){let t=s.start_x;for(let e=s.start_y;e<=s.end_y;e++)s.selected_coors.push({x:t--,y:e})}else console.log("direction not found");return s.selected_coors}}class l{constructor(t,e,s,i,r,o){this.scene=t,this.gridPos=r,this.char=o,this.createCell(e,s,i)}createCell(t,e,s){this.cell=this.scene.add.image(t,e,s),this.cell.setOrigin(0).setInteractive().setDepth(-1)}getCellImg(){return this.cell}getChar(){return this.char}getGridPos(){return this.gridPos}setColor(t){this.cell.setTint(t)}}class d{constructor(t,e,s,i,r,o,n,h){this.cells=[],this.scene=t,this.num_hor_cells=s,this.setCellSize(s,i,r,o,n,h),this.visualWordSearch(e,s,i,h)}drawWordLine(){}visualWordSearch(t,e,s,i){var r,o,n=this.scene.add.text(0,0,"*",{fontFamily:"Arial",fontSize:this.cell_size/1.5,color:6908265,align:"center"}).setVisible(!1),h=this.scene.add.graphics();h.fillStyle(16777215,1),h.fillRoundedRect(0,0,this.cell_size,this.cell_size,0),h.setVisible(!1),this.grid_container=this.scene.add.container(0,0);var a=0,d=0;for(let g=0;g<s;g++){a=0;for(let s=0;s<e;s++){var c=this.scene.add.renderTexture(0,0,this.cell_size,this.cell_size).setVisible(!1);o=t[g][s],n.setText(o);let e=Math.floor((this.cell_size-n.width)/2),m=Math.floor((this.cell_size-n.height)/2);c.draw(h,0,0),c.draw(n,e,m),r="cell_"+g+"_"+s,c.saveTexture(r);const u=new l(this.scene,a,d,r,{x:s,y:g},t[g][s]);this.cells.push(u),a+=this.cell_size+i,this.grid_container.add(u.getCellImg())}d+=this.cell_size+i}}setCellSize(t,e,s,i,r,o){var n,h;n=(i-2*r)/e-o,h=(s-2*r)/t-o,this.cell_size=Math.min(h,n)}getCellSize(){return this.cell_size}getCells(){return this.cells}setCellColor(t,e,s){this.cells[t+e*this.num_hor_cells].setColor(s)}setPosition(t,e){this.grid_container.setPosition(t,e)}getGridBounds(){return this.grid_container.getBounds()}}class c{constructor(t,e,s,i,r){this.wordAlpha=.6,this.scene=t,this.text_string=i.word,this.text=this.scene.add.text(e,s,i.word_input,{fontFamily:"Arial",fontSize:r,color:"#FFFFFF"}),this.text.setOrigin(0,0)}getTextObj(){return this.text}scribeWord(t,e,s,i){this.word_strikethrough=this.scene.add.graphics({lineStyle:{width:e,color:s,alpha:i}}),this.scene.tweens.addCounter({from:this.text.getBounds().left,to:this.text.getBounds().right,duration:t,onUpdate:t=>{var e=t.getValue();this.word_strikethrough.clear(),this.line=new Phaser.Geom.Line(this.text.getBounds().left,this.text.getBounds().centerY,e,this.text.getBounds().centerY),this.word_strikethrough.strokeLineShape(this.line)}}),this.text.setAlpha(this.wordAlpha)}getText(){return this.text_string}}class g{constructor(t,e,s){this.wordsArr=[],this.scene=t,console.log(e),this.drawWords(e,s)}drawWords(t,e){this.container=this.scene.add.container(Math.floor(0),Math.floor(0));var s=0,i=[...t];i=this.shuffleArray(i);for(let r=0;r<i.length;r++){const t=new c(this.scene,0,s,i[r],Math.floor(e/1.8));s+=Math.floor(e/1.4),this.container.add(t.getTextObj()),this.wordsArr.push(t)}}shuffleArray(t){for(var e=t.length-1;e>0;e--){var s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}return t}setWordsPosition(t,e){this.container.setPosition(t,e)}scribeWord(t,e,s,i,r){for(const o of this.wordsArr)console.log(o),console.log(t),o.getText()===t&&o.scribeWord(r,e,s,i)}}class m extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.freezeGame=!1,this.ascii_uppercase="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this.empty_char="*",this.gird_w_ratio=.7,this.gird_h_ratio=.8,this.side_gap=50,this.cells_gap=1,this.lineColor=16763996,this.scribeDuration=1e3,this.lineWidth=8,this.lineAlpha=.7,this.getFormattedWords=t=>{const e=[];return t.forEach((t=>{const s=t.word.toUpperCase();e.push({word:s.split(" ").join(""),word_input:s})})),e},this.directionsArray=t=>{const e=[];for(let[s,i]of Object.entries(t))i&&e.push(s);return e}}init(t){this.gameHeight=this.sys.canvas.height,this.gameWidth=this.sys.canvas.width,this.num_horizontal_cells=t.num_horizontal_cells,this.num_vertical_cells=t.num_vertical_cells,this.words=t.words,this.directions=t.directions,this.timer=t.timer,this.time_to_complete=t.time_to_complete,this.gameId=t.gameId,this.prefix=t.prefix}create(){new r(this,"bg",this.gameWidth,this.gameHeight).setAlpha(.3),this.mainEmitter=new Phaser.Events.EventEmitter,this.words=this.getFormattedWords(this.words),s.TOTAL_WORDS=this.words.length;const t=new n(this,this.num_horizontal_cells,this.num_vertical_cells,this.words,this.directionsArray(this.directions),this.empty_char),e=new h(this,t.getGrid(),this.num_horizontal_cells,this.num_vertical_cells,this.empty_char,this.ascii_uppercase);this.wordsGrid=e.getPopulatedGrid(),t.printGrid(this.wordsGrid,this.num_horizontal_cells,this.num_vertical_cells),this.visual=new d(this,e.getPopulatedGrid(),this.num_horizontal_cells,this.num_vertical_cells,this.gameWidth*this.gird_w_ratio,this.gameHeight*this.gird_h_ratio,this.side_gap,this.cells_gap);const i=this.visual.getGridBounds().bottom-this.visual.getGridBounds().top,l=this.gameHeight/1.8-i/2;this.visual.setPosition(this.side_gap,l),this.sideWords=new g(this,this.words,this.visual.getCellSize()),this.sideWords.setWordsPosition(this.gameWidth*this.gird_w_ratio,this.visual.getGridBounds().top),new a(this,e.getPopulatedGrid(),this.visual.getCells(),this.lineColor,this.num_horizontal_cells,this.mainEmitter),this.mainEmitter.on("guessedWord",this.wordInputHandler,this),this.right_guess=this.sound.add("right_guess"),this.finish_game=this.sound.add("finish_game"),this.game_over=this.sound.add("game_over");let c="";this.timer&&(s.TIME=this.time_to_complete,c=`${s.TIME}`,this.timedEvent=this.time.delayedCall(1e3*this.time_to_complete,this.onEventTimeOver,[],this),this.clock=new o(this,this.gameWidth,.1*this.gameHeight),this.clock.updateTime(c))}update(){this.timer&&!s.GAME_OVER&&this.clock.updateTime(`${(this.time_to_complete-this.timedEvent.elapsed/1e3).toFixed(0)}`),s.GAME_OVER&&!this.freezeGame&&(this.freezeGame=!0,this.timer&&this.clock.cancelAnims(),this.scene.launch("GameEndScene",{width:this.gameWidth,height:this.gameHeight,win:s.WIN,gameId:this.gameId,prefix:this.prefix,timer:this.timer?(this.timedEvent.elapsed/1e3).toFixed(0):null}))}onEventTimeOver(){console.log("time over"),s.GAME_OVER=!0,s.WIN=!1}wordInputHandler(t){console.log(t);let e=!1;for(const s of this.words)if(s.word===t.word){e=!0;break}if(e){console.log("match"),console.log(t.gridInfo);for(const e of t.gridInfo)this.visual.setCellColor(e.x,e.y,this.lineColor);this.sideWords.scribeWord(t.word,this.lineWidth,this.lineColor,this.lineAlpha,this.scribeDuration),s.CURRENT_WORDS_D++,console.log(s.CURRENT_WORDS_D),console.log(s.TOTAL_WORDS),s.CURRENT_WORDS_D===s.TOTAL_WORDS?(s.GAME_OVER=!0,s.WIN=!0):this.right_guess.play()}else console.log(" no match")}}class u{constructor(t,e,s,i,r,o){this.scene=t,this.barColor=170,this.barStrokeColor=16763904,this.buildMenu(e,s,i,r,o)}buildMenu(t,e,s,i,r){this.menuRect=this.scene.add.graphics(),this.menuRect.beginPath(),this.menuRect.fillStyle(this.barStrokeColor,1),this.menuRect.fillRoundedRect(t-r/2,e-r/2,s+r,i+r,{tl:20,tr:20,bl:20,br:20}),this.menuRect.strokePath(),this.menuRect.closePath(),this.menuRect.beginPath(),this.menuRect.fillStyle(this.barColor,1),this.menuRect.fillRoundedRect(t,e,s,i,{tl:20,tr:20,bl:20,br:20}),this.menuRect.strokePath(),this.menuRect.closePath()}getMenuRect(){return this.menuRect}}class _ extends Phaser.Scene{constructor(){super({key:"GameEndScene"})}init(t){this.gameWidth=t.width,this.gameHeight=t.height,this.win=t.win,this.gameId=t.gameId,this.prefix=t.prefix,this.timer=t.timer}create(){this.modal=this.add.rectangle(0,0,this.gameWidth,this.gameHeight,0,.6).setOrigin(0);const e=.5*this.gameWidth,i=.5*this.gameHeight,r=this.gameWidth/2-e/2,o=this.gameHeight/2-i/2,n=.015*e;this.menu=new u(this,r,o,e,i,n);let h="";h=this.win?"Parabéns, ganhaste!":"Não conseguiste, tenta outra vez!";let a=this.add.text(0,0,h,{fontFamily:"Arial",fontSize:32,color:"#ffffff",align:"center"});a.setPosition(this.gameWidth/2,o+2*a.height).setOrigin(.5);var l=new Phaser.Geom.Circle(this.gameWidth/2,o+i/2.2,(i-o)/2.1).getPoints(12);let d=0;for(var c=0;c<l.length;c++){var g=l[c];d>l.length-2?d=0:d++;let t=this.add.image(g.x,g.y,"star").setScale(.1).setTint(16763904);this.tweens.add({targets:t,scaleX:.15625,scaleY:.15625,ease:"Sine.easeInOut",duration:1e3,repeat:-1,yoyo:!0})}this.btn=this.add.graphics(),this.btn.fillStyle(16776960,1);const m=e/2,_=i/8,p=this.gameWidth/2-e/4,f=o+.8*i;this.btn.fillRoundedRect(p,f,m,_,24),this.add.text(0,0,"Jogar novamente",{fontFamily:"Arial",fontSize:32,color:"#0000aa",align:"center"}).setPosition(this.gameWidth/2,f+a.height).setOrigin(.5);var w=new Phaser.Geom.Rectangle(p,f,m,_);this.btn.setInteractive(w,Phaser.Geom.Rectangle.Contains),this.btn.on("pointerdown",(()=>{window.location.reload()})),this.finish_game=this.sound.add("finish_game"),this.game_over=this.sound.add("game_over"),s.WIN?this.finish_game.play():this.game_over.play(),t({method:"post",url:this.prefix+"/api/games/statistics-game-finished",data:{gameId:this.gameId,win:this.win,timer:this.timer}})}}const p={type:Phaser.AUTO,parent:"game",backgroundColor:2772329,scale:{width:1600,height:1200,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},fps:{target:30,forceSetTimeOut:!0},scene:[e,m,_]};class f extends Phaser.Game{constructor(t){super(t)}}window.addEventListener("load",(()=>{new f(p)}));
